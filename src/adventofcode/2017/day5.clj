(ns adventofcode.2017.day5
  (:require [clojure.string :as str]))

(def input "2\n1\n2\n-2\n-2\n1\n1\n2\n-2\n0\n-3\n-9\n0\n0\n2\n-12\n-1\n-12\n0\n-16\n-14\n-14\n-3\n-9\n-11\n0\n-23\n-21\n2\n-4\n-28\n-27\n-4\n-19\n-9\n-8\n-25\n-27\n-1\n-29\n-13\n0\n-29\n-29\n-35\n2\n-3\n2\n-2\n-46\n-18\n1\n-47\n-6\n-27\n-47\n-43\n-40\n-25\n-37\n-4\n-31\n1\n-6\n-2\n-38\n-1\n-66\n-33\n-48\n-47\n-9\n-58\n-7\n-57\n-35\n-61\n-11\n0\n-76\n0\n-80\n-77\n-72\n-5\n-47\n-38\n-16\n-28\n-47\n-19\n-42\n-15\n-88\n-34\n-50\n-12\n-54\n-63\n-95\n-1\n-66\n-48\n-14\n-34\n-72\n-63\n-101\n-102\n-107\n-37\n-75\n-28\n-23\n-14\n-61\n-108\n-71\n-113\n-96\n-26\n-28\n-92\n-64\n-47\n-74\n-9\n-113\n-126\n-61\n-36\n-40\n-26\n-73\n-7\n-99\n-3\n-15\n-127\n-104\n-89\n-67\n-81\n-8\n-63\n-109\n-57\n-81\n-101\n-57\n-94\n-78\n-82\n-9\n-118\n-34\n-93\n-147\n-41\n0\n-44\n-57\n-11\n-22\n-86\n-6\n-55\n-47\n-49\n-124\n-139\n-144\n-7\n-23\n-128\n-97\n-27\n-151\n-104\n-94\n-177\n-165\n-136\n-167\n-53\n-15\n-8\n-72\n2\n-4\n-44\n-15\n-177\n-188\n-142\n-71\n-161\n-81\n-169\n-150\n-144\n-193\n-143\n-185\n-33\n-21\n-198\n-97\n-55\n-50\n-183\n-94\n-77\n-138\n-195\n-146\n-4\n-193\n-132\n-88\n-93\n-67\n-100\n-162\n-107\n-17\n-108\n-213\n-123\n-49\n-191\n-180\n-73\n-182\n-125\n-176\n-65\n-189\n-131\n-18\n-145\n-197\n-136\n-53\n-60\n-209\n-67\n-244\n-163\n-246\n-153\n-16\n-231\n-68\n-165\n-42\n-3\n-9\n-178\n-250\n-37\n-128\n-99\n-145\n-234\n-167\n-123\n-222\n-101\n-46\n-52\n-129\n-155\n-85\n-122\n-228\n-150\n-237\n-173\n-29\n-24\n-175\n-229\n-106\n-236\n-234\n-246\n-90\n-105\n-274\n-211\n-94\n-285\n-201\n-92\n-204\n-215\n-115\n-213\n-218\n-2\n-122\n-176\n-2\n-35\n-143\n2\n-190\n-216\n-38\n-247\n-309\n-18\n-119\n-198\n-275\n-91\n-151\n-195\n-299\n-192\n-25\n-162\n-37\n-70\n-30\n-42\n-249\n-156\n-319\n-317\n-264\n-19\n-47\n-38\n-235\n-184\n-25\n-43\n-127\n-168\n-138\n-35\n-24\n-257\n-30\n-259\n-22\n-69\n-80\n0\n-212\n-41\n-20\n-90\n-196\n-169\n-47\n-238\n-320\n-132\n-348\n-301\n-242\n-353\n-63\n-51\n-33\n-270\n-196\n-334\n-160\n-63\n-177\n-42\n-30\n-216\n-219\n-155\n-146\n-192\n-113\n-368\n-349\n-330\n-33\n-4\n-302\n-119\n-387\n-336\n2\n-201\n-344\n1\n-6\n-339\n-311\n-79\n-55\n-67\n-118\n-257\n-215\n-141\n-40\n-117\n-28\n-345\n-312\n-60\n-57\n-43\n-193\n-134\n-144\n-28\n-11\n-138\n-48\n-167\n-76\n-99\n-51\n-283\n-174\n-159\n-72\n-55\n-155\n-343\n-226\n-195\n-364\n-39\n-368\n-117\n-256\n-42\n-172\n-236\n-231\n-133\n-36\n-442\n-178\n-101\n-213\n-142\n-266\n-305\n-95\n-341\n-227\n-217\n-162\n-1\n-168\n-384\n-424\n2\n-394\n-96\n-458\n-258\n-232\n0\n-283\n-393\n-211\n0\n-466\n-431\n-455\n-430\n-459\n0\n-235\n-96\n-371\n-479\n-117\n-39\n-291\n-220\n-403\n-325\n-433\n-189\n-275\n-58\n-109\n-191\n-175\n-416\n-61\n-269\n-411\n-330\n-497\n-487\n-393\n-417\n-275\n-157\n-208\n-196\n-330\n-427\n-361\n-304\n-385\n-16\n-175\n-250\n-101\n-256\n-186\n-369\n-328\n-322\n-190\n-135\n-71\n-455\n-303\n-287\n-95\n-55\n-446\n-489\n-329\n-410\n-372\n-36\n-7\n-407\n-455\n-347\n-160\n-376\n-515\n-414\n-433\n-107\n-508\n-156\n-111\n-81\n-382\n-203\n-3\n-109\n-163\n-61\n-313\n-516\n-277\n-306\n-166\n-286\n-437\n-100\n-117\n-556\n-248\n-326\n-550\n-424\n-21\n-524\n-27\n-69\n-244\n-303\n-124\n-299\n-434\n-364\n-543\n-233\n-189\n-279\n-159\n-49\n-112\n-291\n-173\n-143\n-482\n-202\n-446\n-226\n-439\n-496\n-568\n-171\n-376\n-80\n-189\n-495\n-67\n-22\n-470\n-330\n-329\n-259\n-30\n-201\n-591\n-543\n-33\n-591\n-3\n-493\n-614\n-579\n-283\n-251\n-518\n-230\n-408\n-87\n-438\n-551\n-521\n-424\n0\n-552\n-87\n-311\n-570\n-250\n-552\n-316\n-239\n-628\n-508\n-142\n-56\n-288\n-38\n-567\n-477\n-195\n-337\n-23\n-78\n-237\n-569\n-533\n-345\n-220\n-16\n-223\n-565\n-488\n-152\n-517\n-448\n-563\n-73\n-153\n-275\n-186\n-308\n-576\n-64\n-293\n-118\n-138\n-422\n-645\n-302\n-193\n-171\n-190\n-218\n-330\n-96\n-454\n-343\n-399\n-327\n-484\n-379\n-362\n-484\n-477\n-490\n-243\n-551\n-649\n-418\n-54\n-137\n-355\n-624\n-18\n-294\n-333\n-425\n-540\n-322\n-77\n-201\n-550\n-318\n-571\n-396\n-616\n-626\n-404\n-105\n-661\n-538\n-398\n-690\n-353\n-445\n-523\n-72\n-1\n-502\n-711\n-274\n-81\n-272\n-644\n-598\n-593\n-716\n-355\n-620\n-550\n-427\n-647\n-723\n-275\n-500\n-49\n-4\n-575\n-268\n-336\n-674\n-742\n-285\n-672\n-622\n-591\n-421\n-574\n-167\n-38\n-314\n-597\n-255\n-277\n-651\n-571\n-153\n-292\n-5\n-101\n-348\n-48\n-119\n-448\n-685\n-389\n-471\n-646\n-285\n-239\n-249\n-465\n-198\n-43\n-522\n-19\n-82\n-240\n-521\n-136\n-586\n-195\n-446\n-587\n-58\n-263\n-550\n-449\n-220\n-39\n-691\n-386\n-199\n-96\n-144\n-151\n-593\n-237\n-414\n-238\n-377\n-280\n-638\n-729\n-235\n-603\n-214\n-245\n-714\n-323\n-297\n-558\n-416\n-388\n-271\n-622\n-62\n-726\n-242\n-550\n-277\n-709\n-62\n-266\n-632\n-411\n-327\n-574\n-183\n-467\n-332\n-804\n-693\n-809\n-240\n-496\n-380\n-749\n-466\n-738\n-761\n-832\n-398\n-105\n-675\n-772\n-136\n-4\n-46\n-58\n-836\n-688\n-722\n-466\n-346\n-117\n-183\n-330\n-794\n-101\n-253\n-2\n-519\n-113\n-115\n-439\n-118\n-398\n-326\n-409\n-723\n-719\n-354\n-200\n-647\n-520\n-29\n-130\n-564\n-880\n-823\n-309\n-352\n-822\n-326\n-302\n-452\n-281\n-467\n-316\n-115\n-623\n-625\n-142\n-262\n-382\n-85\n-743\n-340\n-50\n-270\n-118\n-683\n-218\n-595\n-217\n-371\n-397\n-443\n-755\n-909\n-378\n-843\n-644\n-303\n-642\n-798\n-90\n-562\n2\n-733\n-792\n-235\n-536\n-132\n-481\n-386\n-795\n-167\n-145\n-725\n-403\n-533\n-761\n-599\n-732\n-719\n-250\n-239\n-626\n-318\n-135\n-756\n-308\n-287\n-130\n-277\n-265\n-709\n-252\n-679\n-126\n-794\n-6\n-194\n-715\n-703\n-373\n-481\n-928\n-710\n-155\n-431\n-780\n-658\n-897\n-947\n-55\n-271\n-927\n-554\n-165\n-763\n-895\n-329\n-132\n-293\n-134\n-524\n-824\n-277\n-187\n-849\n-193\n-167\n-175\n-125\n-489\n-36\n-960\n-931\n-533\n-9\n-599\n-589\n-795\n-418\n-679\n-793\n-592\n-24\n-100\n-664\n-382\n-524\n-549\n-124\n-899\n-583\n-470\n-897\n-309\n-886\n-291\n-971\n-123\n-122\n-841\n-218\n-62\n-434\n-113\n-138\n-358\n-569\n-182\n-839\n-621\n-596\n-977\n-297\n-590\n-738\n-503\n-334\n-756\n-245\n-505\n-107\n-376\n-958\n-937\n-986\n-942\n-589\n-541\n-612\n-932\n-314\n-114\n-213\n-922\n-31\n-380\n-152\n-512\n-521\n-34\n-613\n-759\n-781\n-256\n-297\n-155\n-853\n-169\n-842\n-567\n-533\n-709\n-19\n-517\n-542\n-376\n-149\n-934\n-496\n-782\n-469\n-320\n-219\n-902\n-155\n-971\n-1074")

(defn parse-input [s]
  (->> s
    (str/split-lines)
    (mapv #(Integer/parseInt ^String % 10))))

(defn f [input incf]
  (let [instr (parse-input input)
        len   (count instr)]
    (loop [steps  0
           idx    0
           !instr (transient instr)]
      (if (<= len idx)
        steps
        (let [offs (get !instr idx)]
          (recur (+ steps 1) (+ idx offs) (assoc! !instr idx (incf offs))))))))


(assert (= 388611 (f input inc)))

(assert (= 27763113 (f input #(if (< % 3) (inc %) (dec %)))))

